var R=Object.defineProperty;var T=(a,r,s)=>r in a?R(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s;var x=(a,r,s)=>T(a,typeof r!="symbol"?r+"":r,s);import{f as V,aa as W,r as E,s as $,Z as z,$ as Z,ab as H,ac as I,ad as B,ae as N,h as D,af as Q,n as X,w as ee,B as ae,R as te,q as J,G as re,o as ne,p as se,O as q,U as ie,ag as G,ah as oe}from"./Dzi8umfP.js";import{u as le}from"./BrpAWIEN.js";function ue(a){return a.validate&&a.__isYupSchema__}function ce(a){return a.inner!==void 0}function de(a){return"schema"in a&&typeof a.coercer=="function"&&typeof a.validator=="function"&&typeof a.refiner=="function"}function fe(a){return a.validateAsync!==void 0&&a.id!==void 0}function me(a){return a.isJoi===!0}function pe(a){return"~standard"in a}async function ye(a,r){var n;const s=await r["~standard"].validate(a);return s.issues?{errors:((n=s.issues)==null?void 0:n.map(o=>{var l;return{name:((l=o.path)==null?void 0:l.map(c=>typeof c=="object"?c.key:c).join("."))||"",message:o.message}}))||[],result:null}:{errors:null,result:s.value}}async function ve(a,r){try{return{errors:null,result:await r.validate(a,{abortEarly:!1})}}catch(s){if(ce(s))return{errors:s.inner.map(o=>({name:o.path??"",message:o.message})),result:null};throw s}}async function he(a,r){const[s,n]=r.validate(a);return s?{errors:s.failures().map(l=>({message:l.message,name:l.path.join(".")})),result:null}:{errors:null,result:n}}async function we(a,r){try{return{errors:null,result:await r.validateAsync(a,{abortEarly:!1})}}catch(s){if(me(s))return{errors:s.details.map(o=>({name:o.path.join("."),message:o.message})),result:null};throw s}}function be(a,r){if(pe(r))return ye(a,r);if(fe(r))return we(a,r);if(ue(r))return ve(a,r);if(de(r))return he(a,r);throw new Error("Form validation failed: Unsupported form schema")}class j extends Error{constructor(s,n,o){super("Form validation exception");x(this,"formId");x(this,"errors");x(this,"children");this.formId=s,this.errors=n,this.children=o,Object.setPrototypeOf(this,j.prototype)}}const Se={base:""},ge=ie;var L;const _e=q({extend:q(Se),...((L=ge.ui)==null?void 0:L.form)||{}}),Ee=V({__name:"Form",props:{id:{},schema:{},state:{},validate:{},validateOn:{default(){return["input","blur","change"]}},disabled:{type:Boolean},validateOnInputDelay:{default:300},transform:{type:Boolean,default:!0},class:{},onSubmit:{}},emits:["submit","error"],setup(a,{expose:r,emit:s}){const n=a,o=s,l=n.id??W(),c=le(`form-${l}`),m=H(G,void 0);I(G,c);const C=E(new Map);$(async()=>{c.on(async e=>{var t;e.type==="attach"?C.value.set(e.formId,{validate:e.validate}):e.type==="detach"?C.value.delete(e.formId):(t=n.validateOn)!=null&&t.includes(e.type)&&!y.value&&(e.type!=="input"?await p({name:e.name,silent:!0,nested:!1}):(e.eager||A.has(e.name))&&await p({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&A.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&K.add(e.name),(e.type==="change"||e.type==="input")&&O.add(e.name)})}),z(()=>{c.reset()}),$(async()=>{m&&(await Z(),m.emit({type:"attach",validate:p,formId:l}))}),z(()=>{m&&m.emit({type:"detach",formId:l})});const i=E([]);I("form-errors",i);const F=E({});I(oe,F);const O=new Set,K=new Set,A=new Set;function k(e){return e.map(t=>{var u;return{...t,id:t!=null&&t.name?(u=F.value[t.name])==null?void 0:u.id:void 0}})}const U=E(null);async function Y(){let e=n.validate?await n.validate(n.state)??[]:[];if(n.schema){const{errors:t,result:u}=await be(n.state,n.schema);t?e=e.concat(t):U.value=u}return k(e)}async function p(e={silent:!1,nested:!0,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name,u=!t&&e.nested?Array.from(C.value.values()).map(({validate:f})=>f(e).then(()=>{}).catch(v=>{if(!(v instanceof j))throw v;return v})):[];if(t){const f=i.value.filter(h=>!t.some(w=>{var S,g,_;const b=(g=(S=F.value)==null?void 0:S[w])==null?void 0:g.pattern;return w===h.name||b&&((_=h.name)==null?void 0:_.match(b))})),v=(await Y()).filter(h=>t.some(w=>{var S,g,_;const b=(g=(S=F.value)==null?void 0:S[w])==null?void 0:g.pattern;return w===h.name||b&&((_=h.name)==null?void 0:_.match(b))}));i.value=f.concat(v)}else i.value=await Y();const d=(await Promise.all(u)).filter(f=>f!==void 0);if(i.value.length+d.length>0){if(e.silent)return!1;throw new j(l,i.value,d)}return e.transform&&Object.assign(n.state,U.value),n.state}const y=E(!1);I(N,B(y));async function M(e){var u;y.value=!0;const t=e;try{t.data=await p({nested:!0,transform:n.transform}),await((u=n.onSubmit)==null?void 0:u.call(n,t)),O.clear()}catch(d){if(!(d instanceof j))throw d;const f={...t,errors:d.errors,children:d.children};o("error",f)}finally{y.value=!1}}const P=D(()=>n.disabled||y.value);return I(Q,D(()=>({disabled:P.value,validateOnInputDelay:n.validateOnInputDelay}))),r({validate:p,errors:i,setErrors(e,t){t?i.value=i.value.filter(u=>u.name!==t).concat(k(e)):i.value=k(e)},async submit(){await M(new Event("submit"))},getErrors(e){return e?i.value.filter(t=>t.name===e):i.value},clear(e){e?i.value=i.value.filter(t=>t.name!==e):i.value=[]},disabled:P,dirty:D(()=>!!O.size),dirtyFields:B(O),blurredFields:B(A),touchedFields:B(K)}),(e,t)=>(ne(),X(re(J(m)?"div":"form"),{id:J(l),class:te(J(_e)({class:n.class})),onSubmit:ae(M,["prevent"])},{default:ee(()=>[se(e.$slots,"default",{errors:i.value})]),_:3},40,["id","class"]))}}),Oe=Object.assign(Ee,{__name:"UForm"});export{Oe as _};
